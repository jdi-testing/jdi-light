language: java
stages:
  - prepare
  - test
  - reports

jobs:
  include:
    - stage: prepare
      name: Welcome to jdi
      script:
        - echo ------------------- WELCOME TO JDI ----------------------
        - mvn --version #it is helpful

    - stage: test
      name: Run tests - all builds
      script:
        - echo "TRAVIS_EVENT_TYPE=$TRAVIS_EVENT_TYPE"
        - echo "TRAVIS_BRANCH=$TRAVIS_BRANCH"
        - echo "TRAVIS_PULL_REQUEST_BRANCH=$TRAVIS_PULL_REQUEST_BRANCH"
        - echo "TRAVIS_PULL_REQUEST=$TRAVIS_PULL_REQUEST"

    - stage: test
      name: Run tests - cron only
      if: type = cron
      script:
        - echo "TRAVIS_EVENT_TYPE=$TRAVIS_EVENT_TYPE"
        - echo "TRAVIS_BRANCH=$TRAVIS_BRANCH"
        - echo "TRAVIS_PULL_REQUEST_BRANCH=$TRAVIS_PULL_REQUEST_BRANCH"
        - echo "TRAVIS_PULL_REQUEST=$TRAVIS_PULL_REQUEST"

    - stage: reports
      name: Deploy allure reports to netlify
      script:
        - npm install -g allure-commandline
        - npm install -g netlify-cli
        - allure --version
        - source reports.sh
        - deployAllureResults
after_failure:
  - echo "Build was failed"
after_success:
  - echo "Build was successful"
after_script:
  - source reports.sh
  - grubAllureResults
  - du -d 1 -h ./
  - ls -la
# extra time during long builds
install:
  - travis_wait
